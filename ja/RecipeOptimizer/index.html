<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>レシピ最適化ツール（GLPK版）</title>
<script src="https://cdn.jsdelivr.net/gh/hgourvest/glpk.js@0.19.0/dist/glpk.min.js"></script>
<style>
body { font-family: sans-serif; padding: 20px; margin:0; box-sizing:border-box; }
.wrapper { width: 100%; max-width: 100%; overflow-x: auto; }

.stock-container { display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 10px; }
.stock-container div { display: flex; align-items: center; gap: 5px; }
input { width: 60px; }

table { border: 1px solid #ccc; border-collapse: collapse; width: 100%; max-width: 100%; }
th, td { border: 1px solid #ccc; padding: 5px; text-align: center; }
th { background-color: #f0f0f0; }

@media (max-width: 600px) {
  .stock-container { flex-direction: column; }
  input { width: 50px; }
  table { font-size: 12px; }
}
</style>
</head>
<body>
<div class="wrapper">
<h2>レシピ最適化ツール（GLPK版）</h2>

<h3>所持食材数を入力</h3>
<div class="stock-container">
  <div>肉: <input type="number" id="stock_meat" value="0" min="0"></div>
  <div>魚: <input type="number" id="stock_fish" value="0" min="0"></div>
  <div>人参: <input type="number" id="stock_carrot" value="0" min="0"></div>
  <div>塩: <input type="number" id="stock_salt" value="0" min="0"></div>
  <div>水: <input type="number" id="stock_water" value="0" min="0"></div>
</div>
<button onclick="calculate()">計算</button>

<h3>料理一覧（消費素材数 + 調理回数）</h3>
<table id="recipe_table">
<tr>
  <th>料理</th>
  <th>肉</th>
  <th>魚</th>
  <th>人参</th>
  <th>塩</th>
  <th>水</th>
  <th>作成回数</th>
</tr>
</table>

<h3>余った食材</h3>
<ul id="leftover_list"></ul>
</div>

<script>
// レシピデータ
const recipes = {
  炭火焼き魚: {肉:0, 魚:30, 人参:5, 塩:15, 水:0},
  炭火焼きリブ: {肉:30, 魚:0, 人参:5, 塩:15, 水:0},
  炭火焼き野菜: {肉:0, 魚:0, 人参:30, 塩:15, 水:5},
  風味豊かな魚: {肉:0, 魚:25, 人参:0, 塩:15, 水:5},
  風味豊かな肉: {肉:25, 魚:0, 人参:0, 塩:15, 水:5},
  風味豊かな野菜: {肉:0, 魚:0, 人参:25, 塩:15, 水:5},
  タラのスープ: {肉:0, 魚:15, 人参:0, 塩:5, 水:20},
  煮込みリブ: {肉:15, 魚:0, 人参:5, 塩:0, 水:20},
  濃厚な野菜スープ: {肉:0, 魚:0, 人参:15, 塩:5, 水:20},
  塩漬けニシン: {肉:0, 魚:15, 人参:5, 塩:5, 水:0},
  塩漬け干し肉: {肉:15, 魚:0, 人参:5, 塩:5, 水:0},
  蒸しシーフード盛り合わせ: {肉:0, 魚:15, 人参:5, 塩:0, 水:10},
  焼肉盛り合わせ: {肉:15, 魚:0, 人参:5, 塩:10, 水:0},
  美味しい野菜盛り合わせ: {肉:0, 魚:0, 人参:15, 塩:5, 水:10},
  ご馳走盛り合わせ: {肉:0, 魚:5, 人参:15, 塩:10, 水:0}
};

function showRecipeTable(counts={}) {
  const table = document.getElementById('recipe_table');
  table.innerHTML = "<tr><th>料理</th><th>肉</th><th>魚</th><th>人参</th><th>塩</th><th>水</th><th>作成回数</th></tr>";
  for (let r in recipes) {
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${r}</td>
                    <td>${recipes[r].肉}</td>
                    <td>${recipes[r].魚}</td>
                    <td>${recipes[r].人参}</td>
                    <td>${recipes[r].塩}</td>
                    <td>${recipes[r].水}</td>
                    <td>${counts[r] || 0}</td>`;
    table.appendChild(tr);
  }
}

function calculate() {
  const stock = {
    肉: parseInt(document.getElementById('stock_meat').value) || 0,
    魚: parseInt(document.getElementById('stock_fish').value) || 0,
    人参: parseInt(document.getElementById('stock_carrot').value) || 0,
    塩: parseInt(document.getElementById('stock_salt').value) || 0,
    水: parseInt(document.getElementById('stock_water').value) || 0
  };

  const recipeNames = Object.keys(recipes);
  
  // GLPK用モデル作成
  const lp = {
    name: 'RecipeOptimization',
    objective: { direction: glpk.GLP_MAX, name: 'total', vars: [] },
    subjectTo: []
  };

  // 変数（各料理の作成回数）
  recipeNames.forEach(r => {
    lp.objective.vars.push({ name: r, coef: 1 });
  });

  // 制約（素材ごと）
  ['肉','魚','人参','塩','水'].forEach(mat => {
    let cons = { name: mat, vars: [], bnds: { type: glpk.GLP_UP, ub: stock[mat], lb:0 } };
    recipeNames.forEach(r => {
      cons.vars.push({ name: r, coef: recipes[r][mat] });
    });
    lp.subjectTo.push(cons);
  });

  // GLPKで解く
  const result = glpk.solve(lp, { msgLevel: glpk.GLP_MSG_OFF });

  // 作成回数を整数に丸める
  let counts = {};
  recipeNames.forEach(r => {
    counts[r] = Math.floor(result.result.vars[r]) || 0;
  });

  showRecipeTable(counts);

  // 余った素材
  let leftover = {...stock};
  for (let r in counts) {
    const count = counts[r];
    for (let mat in recipes[r]) {
      leftover[mat] -= recipes[r][mat]*count;
    }
  }

  const ul = document.getElementById('leftover_list');
  ul.innerHTML = '';
  for (let mat in leftover) {
    let li = document.createElement('li');
    li.textContent = `${mat}: ${leftover[mat]}`;
    ul.appendChild(li);
  }
}

showRecipeTable();
</script>
</body>
</html>
